import{b as ne,d as ce}from"./chunk-V2NX6UVO.js";import{B as w,C as h,D as O,E as P,F as n,G as _,S as ae,V as se,Y as pe,b as ie,i as oe,k as R,l as Y,t as G}from"./chunk-EHGRRDZP.js";import{$ as E,Ab as V,Eb as N,Gc as x,Hb as g,Hc as re,Jb as M,Rb as u,Sb as z,Va as v,Wb as te,X as f,Xb as W,Yb as S,Zb as b,a as D,aa as A,b as k,c as $,fa as a,hb as U,ja as l,ka as B,mb as I,ob as c,ra as q,sa as L,t as j,tb as F,va as T,yb as s,zb as p}from"./chunk-6SZU5MVO.js";var De=t=>[t,"user-management"],Ie=t=>[t,"events"],me=(()=>{let e=class e{constructor(){this.authService=a(h)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=l({type:e,selectors:[["app-home"]],decls:5,vars:6,consts:[["mat-stroked-button","",3,"routerLink"],["mat-flat-button","",3,"routerLink"]],template:function(i,o){i&1&&(s(0,"button",0),u(1," Modifica utente "),p(),s(2,"button",1),u(3,` Eventi
`),p(),V(4,"router-outlet")),i&2&&(c("routerLink",W(2,De,o.authService.currentUser.type)),v(2),c("routerLink",W(4,Ie,o.authService.currentUser.type)))},dependencies:[oe,R,G],changeDetection:0});let t=e;return t})();var H=(()=>{let e=class e extends w{constructor(){super(),this.authService=a(h),this.apiPath="users"}usersByPartyAndType(){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:ne({partyId:this.authService.partyId||"",type:O.PLAYER})}})}getUserById(){return this.excludePasswordFromData(this.apiCall({type:"GET",url:`${this.apiUrl}/${this.authService.currentUser.id}`}))}updateUser(r){return this.excludePasswordFromData(this.apiCall({type:"PATCH",url:`${this.apiUrl}/${this.authService.currentUser.id}`,options:{body:r}}).pipe(f(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})})))}excludePasswordFromData(r){return r.pipe(j(i=>{let C=i,{password:o}=C;return $(C,["password"])}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Ye=[{name:"firstName",label:"Nome",type:"text",validators:[n.required]},{name:"lastName",label:"congnome",type:"text",validators:[n.required]},{name:"city",label:"La tua citt\xE0",type:"text",validators:[n.required]},{name:"email",label:"Indirizzo Email",type:"text",validators:[n.required,n.email]},{name:"phone",label:"Numero di telefono",type:"text",validators:[n.required,n.pattern(/^\+\d{2}\s\d{10}$/)],errorMessage:"deve essere un numero di telefono valido"},{name:"notes",label:"note",type:"textarea",validators:[n.required,n.minLength(10),n.maxLength(100)]}],le=[{name:"email",label:"Indirizzo email",type:"text",validators:[n.required,n.email]},{name:"password",label:"Password",type:"password"}],ue=[{name:"email",type:"text",label:"Email"},{name:"type",type:"text",label:"Type"},{name:"detail",type:"action",label:"Go to detail"}];function Ee(t,e){if(t&1){let d=N();s(0,"app-table",1),g("onAction",function(i){q(d);let o=M();return L(o.goToDetail(i))}),p()}if(t&2){let d=M();c("data",e)("columns",d.tableConfig)}}var de=(()=>{let e=class e extends P{constructor(){super(...arguments),this.userService=a(H),this.users$=this.userService.usersByPartyAndType(),this.tableConfig=ue}goToDetail(r){this.router.navigate(["master","character",r.id])}};e.\u0275fac=(()=>{let r;return function(o){return(r||(r=T(e)))(o||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-master"]],features:[U],decls:2,vars:3,consts:[[3,"data","columns"],[3,"onAction","data","columns"]],template:function(i,o){if(i&1&&(I(0,Ee,1,2,"app-table",0),S(1,"async")),i&2){let m;F((m=b(1,1,o.users$))?0:-1,m)}},dependencies:[se,x],changeDetection:0});let t=e;return t})();var Q=(()=>{let e=class e extends w{constructor(){super(),this.authService=a(h),this.apiPath="characters"}getCharacter(r=null){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:new ie().set("partyId",this.authService.currentUser.partyId).set("userID",r||this.authService.currentUser.id)}}).pipe(j(i=>i[0]))}updateCharacter(r,i){return this.apiCall({type:"PATCH",url:`${this.apiUrl}/${i}`,options:{body:r}}).pipe(f(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})}))}createCharacter(r){let i=k(D({},r),{partyId:this.authService.currentUser.partyId,userID:this.authService.currentUser.id});return this.apiCall({type:"POST",url:`${this.apiUrl}`,options:{body:i}}).pipe(f(()=>{this.snackbar.open("Utente creato con successo","chiudi",{duration:2e3})}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Te=["Barbaro","Negromante","Druido","Chierico","Ladro","Warlock","Paladino"],Ue=["Elfo","Nano","Gnomo","Umano","Orco"],Fe=["Soldato","Accolito","Furante"];function K(t){return t.map(e=>({label:e,value:e}))}var fe=[{name:"name",label:"Nome del personaggio",type:"text",validators:[n.required]},{name:"class",label:"Classe del personaggio",type:"select",options:K(Te),validators:[n.required]},{name:"race",label:"Razza",type:"select",options:K(Ue),validators:[n.required]},{name:"background",label:"Background",type:"select",options:K(Fe),validators:[n.required]},{name:"strength",label:"Forza",type:"number",validators:[n.required]}];var ye=(()=>{let e=class e{constructor(){this.characterService=a(Q),this.character$=this.characterService.getCharacter().pipe(f(r=>{this.currentCharacterID=r?.id,this.currentCharacterData=r})),this.formConfig=fe}handleSubmit(r){console.log(this.currentCharacterData),this.currentCharacterData?this.character$=this.characterService.updateCharacter(r,this.currentCharacterID):this.character$=this.characterService.createCharacter(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=l({type:e,selectors:[["app-player"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(i,o){i&1&&(s(0,"app-form",0),S(1,"async"),g("onSubmit",function(C){return o.handleSubmit(C)}),p()),i&2&&c("formConfig",o.formConfig)("startingValues",b(1,2,o.character$))},dependencies:[_,x],changeDetection:0});let t=e;return t})();var X=(()=>{let e=class e{constructor(){this.userService=a(H),this.userData$=this.userService.getUserById().pipe(f(r=>{this.userDataStore=r})),this.formConfig=le}handleSubmit(r){let ee=r,{password:i}=ee,o=$(ee,["password"]),m=r.password?r:o,C=D(D({},this.userDataStore),m);this.userData$=this.userService.updateUser(C)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=l({type:e,selectors:[["app-user-management"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(i,o){i&1&&(s(0,"app-form",0),S(1,"async"),g("onSubmit",function(C){return o.handleSubmit(C)}),p()),i&2&&c("formConfig",o.formConfig)("startingValues",b(1,2,o.userData$))},dependencies:[_,x],changeDetection:0});let t=e;return t})();var Me=()=>["/master"];function we(t,e){if(t&1&&(s(0,"h1"),u(1),p(),s(2,"h2"),u(3),p(),s(4,"h3"),u(5),p()),t&2){let d=e;v(),z(d.name),v(2),z(d.class),v(2),z(d.race)}}function Pe(t,e){t&1&&(s(0,"p"),u(1," Non \xE8 stato creato ancora nessun personaggio da questo utente! "),p(),V(2,"p"))}var Ce=(()=>{let e=class e extends P{constructor(){super(...arguments),this.characterService=a(Q),this.userId=this.routeParams.id,this.character$=this.characterService.getCharacter(this.userId)}};e.\u0275fac=(()=>{let r;return function(o){return(r||(r=T(e)))(o||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-character-detail"]],features:[U],decls:6,vars:5,consts:[["mat-button","",3,"routerLink"]],template:function(i,o){if(i&1&&(s(0,"button",0)(1,"mat-icon"),u(2,"arrow_back"),p()(),I(3,we,6,3),S(4,"async"),I(5,Pe,3,0)),i&2){let m;c("routerLink",te(4,Me)),v(3),F((m=b(4,2,o.character$))?3:5,m)}},dependencies:[R,G,ae,x],changeDetection:0});let t=e;return t})();var ve=[{name:"title",label:"Titolo Evento",type:"text",validators:[n.required]},{name:"content",label:"Inserisci il contenuto del tuo evento",type:"textarea",validators:[n.required]}];var ge=(()=>{let e=class e extends w{constructor(){super(),this.authService=a(h),this.apiPath="events"}createEvent(r){let i=this.authService.partyId,o=new Date,m=k(D({},r),{partyId:i,creationDate:o.getTime()});return this.apiCall({type:"POST",url:this.apiUrl,options:{body:m}}).pipe(f(C=>{this.snackbar.open("Evento Creato con successo","chiudi",{duration:2e3})}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function _e(t,e){if(t&1){let d=N();s(0,"app-form",1),g("onSubmit",function(i){q(d);let o=M();return L(o.handleCreation(i))}),p()}if(t&2){let d=M();c("formConfig",d.formConfig)}}var Z=(()=>{let e=class e extends P{constructor(){super(...arguments),this.authService=a(h),this.eventsService=a(ge),this.userTypes=O,this.formConfig=ve,this.currentUserType=this.authService.currentUser.type}handleCreation(r){this.takeUntilDestroy(this.eventsService.createEvent(r)).subscribe()}};e.\u0275fac=(()=>{let r;return function(o){return(r||(r=T(e)))(o||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-events"]],features:[U],decls:4,vars:1,consts:[[3,"formConfig"],[3,"onSubmit","formConfig"]],template:function(i,o){i&1&&(s(0,"p"),u(1,"events works!"),p(),u(2,` visualizzi la lista degli eventi
---
`),I(3,_e,1,1,"app-form",0)),i&2&&(v(3),F(o.currentUserType===o.userTypes.MASTER?3:-1))},dependencies:[_],changeDetection:0});let t=e;return t})();var ke=[{path:"",component:me,children:[{path:"master",component:de},{path:"master/user-management",component:X},{path:"master/character/:id",component:Ce},{path:"master/events",component:Z},{path:"player",component:ye},{path:"player/user-management",component:X},{path:"player/events",component:Z}]}],Se=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=B({type:e}),e.\u0275inj=A({imports:[Y.forChild(ke),Y]});let t=e;return t})();var Er=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=B({type:e}),e.\u0275inj=A({imports:[re,Se,pe,ce]});let t=e;return t})();export{Er as HomeModule};
