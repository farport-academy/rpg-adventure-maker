import{b as oe,d as pe}from"./chunk-V2NX6UVO.js";import{B as _,C as b,D as ie,E as q,F as a,G as L,S as ae,V as ne,Y as se,b as te,i as re,k as B,l as R,t as j}from"./chunk-EHGRRDZP.js";import{$ as F,Ab as k,Eb as K,Gc as C,Hb as S,Hc as ee,Jb as z,Rb as h,Sb as A,Va as D,Wb as X,X as u,Xb as Z,Yb as f,Zb as y,a as x,aa as T,b as W,c as U,fa as n,hb as E,ja as m,ka as P,mb as I,ob as l,ra as Y,sa as J,t as M,tb as $,va as w,yb as s,zb as p}from"./chunk-6SZU5MVO.js";var ve=t=>[t,"user-management"],ce=(()=>{let e=class e{constructor(){this.authService=n(b)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=m({type:e,selectors:[["app-home"]],decls:3,vars:3,consts:[["mat-stroked-button","",3,"routerLink"]],template:function(i,o){i&1&&(s(0,"button",0),h(1," Modifica utente "),p(),k(2,"router-outlet")),i&2&&l("routerLink",Z(1,ve,o.authService.currentUser.type))},dependencies:[re,B,j],changeDetection:0});let t=e;return t})();var N=(()=>{let e=class e extends _{constructor(){super(),this.authService=n(b),this.apiPath="users"}usersByPartyAndType(){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:oe({partyId:this.authService.partyId||"",type:ie.PLAYER})}})}getUserById(){return this.excludePasswordFromData(this.apiCall({type:"GET",url:`${this.apiUrl}/${this.authService.currentUser.id}`}))}updateUser(r){return this.excludePasswordFromData(this.apiCall({type:"PATCH",url:`${this.apiUrl}/${this.authService.currentUser.id}`,options:{body:r}}).pipe(u(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})})))}excludePasswordFromData(r){return r.pipe(M(i=>{let d=i,{password:o}=d;return U(d,["password"])}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Ge=[{name:"firstName",label:"Nome",type:"text",validators:[a.required]},{name:"lastName",label:"congnome",type:"text",validators:[a.required]},{name:"city",label:"La tua citt\xE0",type:"text",validators:[a.required]},{name:"email",label:"Indirizzo Email",type:"text",validators:[a.required,a.email]},{name:"phone",label:"Numero di telefono",type:"text",validators:[a.required,a.pattern(/^\+\d{2}\s\d{10}$/)],errorMessage:"deve essere un numero di telefono valido"},{name:"notes",label:"note",type:"textarea",validators:[a.required,a.minLength(10),a.maxLength(100)]}],me=[{name:"email",label:"Indirizzo email",type:"text",validators:[a.required,a.email]},{name:"password",label:"Password",type:"password"}],le=[{name:"email",type:"text",label:"Email"},{name:"type",type:"text",label:"Type"},{name:"detail",type:"action",label:"Go to detail"}];function Se(t,e){if(t&1){let v=K();s(0,"app-table",1),S("onAction",function(i){Y(v);let o=z();return J(o.goToDetail(i))}),p()}if(t&2){let v=z();l("data",e)("columns",v.tableConfig)}}var ue=(()=>{let e=class e extends q{constructor(){super(...arguments),this.userService=n(N),this.users$=this.userService.usersByPartyAndType(),this.tableConfig=le}goToDetail(r){this.router.navigate(["master","character",r.id])}};e.\u0275fac=(()=>{let r;return function(o){return(r||(r=w(e)))(o||e)}})(),e.\u0275cmp=m({type:e,selectors:[["app-master"]],features:[E],decls:2,vars:3,consts:[[3,"data","columns"],[3,"onAction","data","columns"]],template:function(i,o){if(i&1&&(I(0,Se,1,2,"app-table",0),f(1,"async")),i&2){let c;$((c=y(1,1,o.users$))?0:-1,c)}},dependencies:[ne,C],changeDetection:0});let t=e;return t})();var V=(()=>{let e=class e extends _{constructor(){super(),this.authService=n(b),this.apiPath="characters"}getCharacter(r=null){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:new te().set("partyId",this.authService.currentUser.partyId).set("userID",r||this.authService.currentUser.id)}}).pipe(M(i=>i[0]))}updateCharacter(r,i){return this.apiCall({type:"PATCH",url:`${this.apiUrl}/${i}`,options:{body:r}}).pipe(u(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})}))}createCharacter(r){let i=W(x({},r),{partyId:this.authService.currentUser.partyId,userID:this.authService.currentUser.id});return this.apiCall({type:"POST",url:`${this.apiUrl}`,options:{body:i}}).pipe(u(()=>{this.snackbar.open("Utente creato con successo","chiudi",{duration:2e3})}))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var be=["Barbaro","Negromante","Druido","Chierico","Ladro","Warlock","Paladino"],xe=["Elfo","Nano","Gnomo","Umano","Orco"],De=["Soldato","Accolito","Furante"];function O(t){return t.map(e=>({label:e,value:e}))}var de=[{name:"name",label:"Nome del personaggio",type:"text",validators:[a.required]},{name:"class",label:"Classe del personaggio",type:"select",options:O(be),validators:[a.required]},{name:"race",label:"Razza",type:"select",options:O(xe),validators:[a.required]},{name:"background",label:"Background",type:"select",options:O(De),validators:[a.required]},{name:"strength",label:"Forza",type:"number",validators:[a.required]}];var he=(()=>{let e=class e{constructor(){this.characterService=n(V),this.character$=this.characterService.getCharacter().pipe(u(r=>{this.currentCharacterID=r?.id,this.currentCharacterData=r})),this.formConfig=de}handleSubmit(r){console.log(this.currentCharacterData),this.currentCharacterData?this.character$=this.characterService.updateCharacter(r,this.currentCharacterID):this.character$=this.characterService.createCharacter(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=m({type:e,selectors:[["app-player"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(i,o){i&1&&(s(0,"app-form",0),f(1,"async"),S("onSubmit",function(d){return o.handleSubmit(d)}),p()),i&2&&l("formConfig",o.formConfig)("startingValues",y(1,2,o.character$))},dependencies:[L,C],changeDetection:0});let t=e;return t})();var H=(()=>{let e=class e{constructor(){this.userService=n(N),this.userData$=this.userService.getUserById().pipe(u(r=>{this.userDataStore=r})),this.formConfig=me}handleSubmit(r){let Q=r,{password:i}=Q,o=U(Q,["password"]),c=r.password?r:o,d=x(x({},this.userDataStore),c);this.userData$=this.userService.updateUser(d)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=m({type:e,selectors:[["app-user-management"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(i,o){i&1&&(s(0,"app-form",0),f(1,"async"),S("onSubmit",function(d){return o.handleSubmit(d)}),p()),i&2&&l("formConfig",o.formConfig)("startingValues",y(1,2,o.userData$))},dependencies:[L,C],changeDetection:0});let t=e;return t})();var Ue=()=>["/master"];function Me(t,e){if(t&1&&(s(0,"h1"),h(1),p(),s(2,"h2"),h(3),p(),s(4,"h3"),h(5),p()),t&2){let v=e;D(),A(v.name),D(2),A(v.class),D(2),A(v.race)}}function Fe(t,e){t&1&&(s(0,"p"),h(1," Non \xE8 stato creato ancora nessun personaggio da questo utente! "),p(),k(2,"p"))}var fe=(()=>{let e=class e extends q{constructor(){super(...arguments),this.characterService=n(V),this.userId=this.routeParams.id,this.character$=this.characterService.getCharacter(this.userId)}};e.\u0275fac=(()=>{let r;return function(o){return(r||(r=w(e)))(o||e)}})(),e.\u0275cmp=m({type:e,selectors:[["app-character-detail"]],features:[E],decls:6,vars:5,consts:[["mat-button","",3,"routerLink"]],template:function(i,o){if(i&1&&(s(0,"button",0)(1,"mat-icon"),h(2,"arrow_back"),p()(),I(3,Me,6,3),f(4,"async"),I(5,Fe,3,0)),i&2){let c;l("routerLink",X(4,Ue)),D(3),$((c=y(4,2,o.character$))?3:5,c)}},dependencies:[B,j,ae,C],changeDetection:0});let t=e;return t})();var Te=[{path:"",component:ce,children:[{path:"master",component:ue},{path:"master/user-management",component:H},{path:"master/character/:id",component:fe},{path:"player",component:he},{path:"player/user-management",component:H}]}],ye=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=P({type:e}),e.\u0275inj=T({imports:[R.forChild(Te),R]});let t=e;return t})();var Zt=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=P({type:e}),e.\u0275inj=T({imports:[ee,ye,se,pe]});let t=e;return t})();export{Zt as HomeModule};
