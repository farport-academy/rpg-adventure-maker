import{A as _,C as T,D as I,E as F,F as d,G as E,H as k,I as w,J as P,K as $,M as J,N as O,O as Q,P as W,Q as X,R as tt,S as et,U as it,Y as ot,i as Y,k as x,l as A,o as Z,t as y,u as K}from"./chunk-EHGRRDZP.js";import{$ as N,Ab as V,Hb as g,Hc as H,Rb as c,Sb as M,V as B,Va as p,Wb as q,aa as v,c as R,ea as G,fa as a,hb as S,ja as u,ka as b,ob as f,s as U,va as D,wc as z,yb as r,zb as s}from"./chunk-6SZU5MVO.js";function nt(i,t){return l=>l.get(i)?.value!==l.get(t)?.value?{passwordMismatch:!0,relatedFields:[i,t]}:null}var rt=[nt("password","confirmPassword")],j=[{name:"email",label:"Indirizzo Email",type:"text",validators:[d.required,d.email]},{name:"password",label:"Password",type:"password",validators:[d.required]},{name:"confirmPassword",label:"Conferma Password",type:"password",validators:[d.required]},{name:"type",label:"Tipo di account",type:"select",options:[{label:"Giocatore",value:I.PLAYER},{label:"Master",value:I.MASTER}],validators:[d.required]}],at=[...j,{name:"partyId",label:"Codice Party ID",type:"text",validators:[d.required]}],st=[{name:"email",label:"Indirizzo Email",type:"text",validators:[d.required,d.email]},{name:"password",label:"Password",type:"password",validators:[d.required]}];var vt=()=>["signup"],pt=(()=>{let t=class t extends F{constructor(){super(...arguments),this.signInFormConfig=st,this.loginRoute=a(Z),this.authService=a(T)}ngOnInit(){}signIn(e){this.takeUntilDestroy(this.authService.login(e)).subscribe({next:()=>this.router.navigate([this.loginRoute])})}};t.\u0275fac=(()=>{let e;return function(n){return(e||(e=D(t)))(n||t)}})(),t.\u0275cmp=u({type:t,selectors:[["app-signin"]],features:[S],decls:6,vars:3,consts:[[1,"card_sm"],[3,"onSubmit","formConfig"],["mat-button","",3,"routerLink"]],template:function(o,n){o&1&&(r(0,"mat-card",0)(1,"mat-card-content")(2,"app-form",1),g("onSubmit",function(m){return n.signIn(m)}),s()(),r(3,"mat-card-actions")(4,"button",2),c(5,"Sign Up"),s()()()),o&2&&(p(2),f("formConfig",n.signInFormConfig),p(2),f("routerLink",q(2,vt)))},dependencies:[x,E,y,k,P,w],styles:[".button-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}"],changeDetection:0});let i=t;return i})();var L=class{constructor(t,l){this._document=l;let e=this._textarea=this._document.createElement("textarea"),o=e.style;o.position="fixed",o.top=o.opacity="0",o.left="-999em",e.setAttribute("aria-hidden","true"),e.value=t,e.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(e)}copy(){let t=this._textarea,l=!1;try{if(t){let e=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),l=this._document.execCommand("copy"),e&&e.focus()}}catch{}return l}destroy(){let t=this._textarea;t&&(t.remove(),this._textarea=void 0)}},dt=(()=>{let t=class t{constructor(e){this._document=e}copy(e){let o=this.beginCopy(e),n=o.copy();return o.destroy(),n}beginCopy(e){return new L(e,this._document)}};t.\u0275fac=function(o){return new(o||t)(G(z))},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var lt=(()=>{let t=class t{constructor(){this.clipBoard=a(dt),this.snackBar=a(_),this.data=a(J)}copyTioClipboard(e){this.clipBoard.copy(e),this.snackBar.open("Party ID copiato","Chiudi",{duration:2e3})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=u({type:t,selectors:[["app-partyId-dialog"]],decls:13,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-mini-fab","",3,"click"],["mat-dialog-actions",""],["mat-flat-button","",3,"mat-dialog-close"]],template:function(o,n){o&1&&(r(0,"h1",0),c(1),s(),r(2,"div",1)(3,"p"),c(4),s(),r(5,"code"),c(6),s(),r(7,"button",2),g("click",function(){return n.copyTioClipboard(n.data.partyId)}),r(8,"mat-icon"),c(9,"content_copy"),s()()(),r(10,"div",3)(11,"button",4),c(12,"Ok"),s()()),o&2&&(p(),M(n.data.title),p(3),M(n.data.content),p(2),M(n.data.partyId),p(5),f("mat-dialog-close",!0))},dependencies:[y,K,et,Q,W,tt,X],encapsulation:2});let i=t;return i})();var ut=(()=>{let t=class t extends F{constructor(){super(...arguments),this.authService=a(T),this.dialog=a(O),this.snackbBar=a(_),this.formConfig=j,this.globalValidators=rt,this.canLeave=!0,this.dialogTitle="Attenzione!",this.dialogContent="I tuoi dati andranno persi"}createUser(e){let h=e,{confirmPassword:o}=h,n=R(h,["confirmPassword"]);this.authService.signup(n).pipe(B(this.destroy$)).subscribe({next:m=>{this.canLeave=!0,m.user.type==="master"?this.partyIdDialog(m):this.router.navigate(["/"]),this.snackbBar.open("Registrazione avvenuta con successo","Chiudi",{duration:2e3})},error:m=>{console.log("erroneous",m.message)}})}partyIdDialog(e){this.dialog.open(lt,{data:{title:"Party ID",content:"Copia il tuo party Id per condividere la partita",partyId:e.user.partyId}}).afterClosed().pipe(B(this.destroy$)).subscribe(n=>{this.router.navigate(["/"])})}canDeactivate(){return this.canLeave}monitorFormState(e){console.log("form",e.value),e.value.type===I.PLAYER?this.formConfig=at:this.formConfig=j,this.canLeave=!(e.touched&&e.dirty)&&e.valid}};t.\u0275fac=(()=>{let e;return function(n){return(e||(e=D(t)))(n||t)}})(),t.\u0275cmp=u({type:t,selectors:[["app-signup"]],features:[S],decls:9,vars:2,consts:[[1,"card_md"],[3,"onSubmit","formState","formConfig","globalValidators"],["mat-button","","routerLink","/"]],template:function(o,n){o&1&&(r(0,"mat-card",0)(1,"mat-card-header")(2,"h1"),c(3,"Create User"),s()(),r(4,"mat-card-content")(5,"app-form",1),g("onSubmit",function(m){return n.createUser(m)})("formState",function(m){return n.monitorFormState(m)}),s()(),r(6,"mat-card-actions")(7,"button",2),c(8,"Sign In"),s()()()),o&2&&(p(5),f("formConfig",n.formConfig)("globalValidators",n.globalValidators))},dependencies:[x,E,y,k,P,w,$],changeDetection:0});let i=t;return i})();var ft=i=>{let t=a(O),l={title:i.dialogTitle,content:i.dialogContent};if(i.canDeactivate())return Promise.resolve(!0);{let e=t.open(it,{data:l});return U(e.afterClosed()).then(o=>o||!1)}};var bt=[{path:"",component:pt},{path:"signup",component:ut,canDeactivate:[ft]}],gt=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=b({type:t}),t.\u0275inj=v({imports:[A.forChild(bt),A]});let i=t;return i})();var ht=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=u({type:t,selectors:[["app-auth"]],decls:1,vars:0,template:function(o,n){o&1&&V(0,"router-outlet")},dependencies:[Y],encapsulation:2,changeDetection:0});let i=t;return i})();var Te=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=b({type:t,bootstrap:[ht]}),t.\u0275inj=v({imports:[H,gt,ot]});let i=t;return i})();export{Te as AuthFeatureModule};
