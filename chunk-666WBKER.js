import{b as H,d as ge}from"./chunk-NSEYFDEM.js";import{B as D,C as y,D as G,E,F as i,G as I,T as ve,W as he,Z as fe,a as le,b as de,i as ue,k as N,l as Z,t as R}from"./chunk-M2DH2HLS.js";import{Ab as s,B as ae,Bb as L,Fb as q,Hc as C,Ib as M,Ic as pe,Jc as me,Kb as z,Sb as d,Tb as V,Ub as se,V as ie,W as re,Wa as v,Xb as ce,Y as x,Yb as Y,Zb as h,_b as f,a as P,aa as O,b as T,ba as $,c as U,ga as r,ib as S,j as ne,k as oe,ka as l,la as j,nb as _,pb as p,sa as A,t as F,ta as B,ub as k,wa as w,zb as c}from"./chunk-KYIDISFL.js";var Ee=t=>[t,"user-management"],Ie=t=>[t,"events"],Ce=(()=>{let e=class e{constructor(){this.authService=r(y)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=l({type:e,selectors:[["app-home"]],decls:5,vars:6,consts:[["mat-stroked-button","",3,"routerLink"],["mat-flat-button","",3,"routerLink"]],template:function(o,a){o&1&&(c(0,"button",0),d(1," Modifica utente "),s(),c(2,"button",1),d(3,` Eventi
`),s(),L(4,"router-outlet")),o&2&&(p("routerLink",Y(2,Ee,a.authService.currentUser.type)),v(2),p("routerLink",Y(4,Ie,a.authService.currentUser.type)))},dependencies:[ue,N,R],changeDetection:0});let t=e;return t})();var Q=(()=>{let e=class e extends D{constructor(){super(),this.authService=r(y),this.apiPath="users"}usersByPartyAndType(){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:H({partyId:this.authService.partyId||"",type:G.PLAYER})}})}getUserById(){return this.excludePasswordFromData(this.apiCall({type:"GET",url:`${this.apiUrl}/${this.authService.currentUser.id}`}))}updateUser(n){return this.excludePasswordFromData(this.apiCall({type:"PATCH",url:`${this.apiUrl}/${this.authService.currentUser.id}`,options:{body:n}}).pipe(x(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})})))}excludePasswordFromData(n){return n.pipe(F(o=>{let g=o,{password:a}=g;return U(g,["password"])}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var ot=[{name:"firstName",label:"Nome",type:"text",validators:[i.required]},{name:"lastName",label:"congnome",type:"text",validators:[i.required]},{name:"city",label:"La tua citt\xE0",type:"text",validators:[i.required]},{name:"email",label:"Indirizzo Email",type:"text",validators:[i.required,i.email]},{name:"phone",label:"Numero di telefono",type:"text",validators:[i.required,i.pattern(/^\+\d{2}\s\d{10}$/)],errorMessage:"deve essere un numero di telefono valido"},{name:"notes",label:"note",type:"textarea",validators:[i.required,i.minLength(10),i.maxLength(100)]}],ye=[{name:"email",label:"Indirizzo email",type:"text",validators:[i.required,i.email]},{name:"password",label:"Password",type:"password"}],be=[{name:"email",type:"text",label:"Email"},{name:"type",type:"text",label:"Type"},{name:"detail",type:"action",label:"Go to detail"}];function Te(t,e){if(t&1){let u=q();c(0,"app-table",1),M("onAction",function(o){A(u);let a=z();return B(a.goToDetail(o))}),s()}if(t&2){let u=z();p("data",e)("columns",u.tableConfig)}}var xe=(()=>{let e=class e extends E{constructor(){super(...arguments),this.userService=r(Q),this.users$=this.userService.usersByPartyAndType(),this.tableConfig=be}goToDetail(n){this.router.navigate(["master","character",n.id])}};e.\u0275fac=(()=>{let n;return function(a){return(n||(n=w(e)))(a||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-master"]],features:[S],decls:2,vars:3,consts:[[3,"data","columns"],[3,"onAction","data","columns"]],template:function(o,a){if(o&1&&(_(0,Te,1,2,"app-table",0),h(1,"async")),o&2){let m;k((m=f(1,1,a.users$))?0:-1,m)}},dependencies:[he,C],changeDetection:0});let t=e;return t})();var W=(()=>{let e=class e extends D{constructor(){super(),this.authService=r(y),this.apiPath="characters"}getCharacter(n=null){return this.apiCall({type:"GET",url:`${this.apiUrl}`,options:{params:new de().set("partyId",this.authService.currentUser.partyId).set("userID",n||this.authService.currentUser.id)}}).pipe(F(o=>o[0]))}updateCharacter(n,o){return this.apiCall({type:"PATCH",url:`${this.apiUrl}/${o}`,options:{body:n}}).pipe(x(()=>{this.snackbar.open("Utente aggiornato con successo","chiudi",{duration:2e3})}))}createCharacter(n){let o=T(P({},n),{partyId:this.authService.currentUser.partyId,userID:this.authService.currentUser.id});return this.apiCall({type:"POST",url:`${this.apiUrl}`,options:{body:o}}).pipe(x(()=>{this.snackbar.open("Utente creato con successo","chiudi",{duration:2e3})}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Ue=["Barbaro","Negromante","Druido","Chierico","Ladro","Warlock","Paladino"],Fe=["Elfo","Nano","Gnomo","Umano","Orco"],$e=["Soldato","Accolito","Furante"];function K(t){return t.map(e=>({label:e,value:e}))}var Me=[{name:"name",label:"Nome del personaggio",type:"text",validators:[i.required]},{name:"class",label:"Classe del personaggio",type:"select",options:K(Ue),validators:[i.required]},{name:"race",label:"Razza",type:"select",options:K(Fe),validators:[i.required]},{name:"background",label:"Background",type:"select",options:K($e),validators:[i.required]},{name:"strength",label:"Forza",type:"number",validators:[i.required]}];var _e=(()=>{let e=class e{constructor(){this.characterService=r(W),this.character$=this.characterService.getCharacter().pipe(x(n=>{this.currentCharacterID=n?.id,this.currentCharacterData=n})),this.formConfig=Me}handleSubmit(n){console.log(this.currentCharacterData),this.currentCharacterData?this.character$=this.characterService.updateCharacter(n,this.currentCharacterID):this.character$=this.characterService.createCharacter(n)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=l({type:e,selectors:[["app-player"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(o,a){o&1&&(c(0,"app-form",0),h(1,"async"),M("onSubmit",function(g){return a.handleSubmit(g)}),s()),o&2&&p("formConfig",a.formConfig)("startingValues",f(1,2,a.character$))},dependencies:[I,C],changeDetection:0});let t=e;return t})();var X=(()=>{let e=class e{constructor(){this.userService=r(Q),this.userData$=this.userService.getUserById().pipe(x(n=>{this.userDataStore=n})),this.formConfig=ye}handleSubmit(n){let te=n,{password:o}=te,a=U(te,["password"]),m=n.password?n:a,g=P(P({},this.userDataStore),m);this.userData$=this.userService.updateUser(g)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=l({type:e,selectors:[["app-user-management"]],decls:2,vars:4,consts:[[3,"onSubmit","formConfig","startingValues"]],template:function(o,a){o&1&&(c(0,"app-form",0),h(1,"async"),M("onSubmit",function(g){return a.handleSubmit(g)}),s()),o&2&&p("formConfig",a.formConfig)("startingValues",f(1,2,a.userData$))},dependencies:[I,C],changeDetection:0});let t=e;return t})();var je=()=>["/master"];function Ae(t,e){if(t&1&&(c(0,"h1"),d(1),s(),c(2,"h2"),d(3),s(),c(4,"h3"),d(5),s()),t&2){let u=e;v(),V(u.name),v(2),V(u.class),v(2),V(u.race)}}function Be(t,e){t&1&&(c(0,"p"),d(1," Non \xE8 stato creato ancora nessun personaggio da questo utente! "),s(),L(2,"p"))}var Oe=(()=>{let e=class e extends E{constructor(){super(...arguments),this.characterService=r(W),this.userId=this.routeParams.id,this.character$=this.characterService.getCharacter(this.userId)}};e.\u0275fac=(()=>{let n;return function(a){return(n||(n=w(e)))(a||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-character-detail"]],features:[S],decls:6,vars:5,consts:[["mat-button","",3,"routerLink"]],template:function(o,a){if(o&1&&(c(0,"button",0)(1,"mat-icon"),d(2,"arrow_back"),s()(),_(3,Ae,6,3),h(4,"async"),_(5,Be,3,0)),o&2){let m;p("routerLink",ce(4,je)),v(3),k((m=f(4,2,a.character$))?3:5,m)}},dependencies:[N,R,ve,C],changeDetection:0});let t=e;return t})();var we=[{name:"title",label:"Titolo Evento",type:"text",validators:[i.required]},{name:"content",label:"Inserisci il contenuto del tuo evento",type:"textarea",validators:[i.required]}];var Se=(()=>{let e=class e extends D{get events$(){return this.eventsSubject.asObservable()}constructor(){super(),this.authService=r(y),this.eventsSubject=new oe([]),this.apiPath="events"}createEvent(n){let o=this.authService.partyId,a=new Date,m=T(P({},n),{partyId:o,creationDate:a.getTime()});this.apiCall({type:"POST",url:this.apiUrl,options:{body:m}}).subscribe(g=>{g&&this.snackbar.open("Evento Creato con successo","chiudi",{duration:2e3})})}getEventsList(){return this.apiCall({type:"GET",url:this.apiUrl,options:{params:H({partyID:this.authService.partyId,_sort:"creationDate",_order:"desc"}),headers:new le().set("disableLoading","true")}})}pollEvents(){this.destroy$=new ne,ae(0,5e3).pipe(ie(()=>this.getEventsList()),re(this.destroy$)).subscribe(n=>{this.eventsSubject.next(n)})}destroyPollEvents(){this.destroy$.next(null),this.destroy$.complete()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Le(t,e){if(t&1){let u=q();c(0,"div",1)(1,"app-form",2),M("onSubmit",function(o){A(u);let a=z();return B(a.handleCreation(o))}),s()()}if(t&2){let u=z();v(),p("formConfig",u.formConfig)}}var ee=(()=>{let e=class e extends E{constructor(){super(...arguments),this.authService=r(y),this.eventsService=r(Se),this.userTypes=G,this.formConfig=we,this.currentUserType=this.authService.currentUser.type,this.events$=this.eventsService.events$}ngOnInit(){this.eventsService.pollEvents()}handleCreation(n){this.eventsService.createEvent(n)}ngOnDestroy(){this.eventsService.destroyPollEvents()}};e.\u0275fac=(()=>{let n;return function(a){return(n||(n=w(e)))(a||e)}})(),e.\u0275cmp=l({type:e,selectors:[["app-events"]],features:[S],decls:7,vars:6,consts:[[1,"events-container"],[1,"events-master-form"],[3,"onSubmit","formConfig"]],template:function(o,a){o&1&&(c(0,"section",0)(1,"pre"),d(2),h(3,"async"),h(4,"json"),s(),d(5,`
---
`),_(6,Le,2,1,"div",1),s()),o&2&&(v(2),se("    ",f(4,4,f(3,2,a.events$)),`
`),v(4),k(a.currentUserType===a.userTypes.MASTER?6:-1))},dependencies:[I,C,pe],styles:['.mat-ripple[_ngcontent-%COMP%]{overflow:hidden;position:relative}.mat-ripple[_ngcontent-%COMP%]:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded[_ngcontent-%COMP%]{overflow:visible}.mat-ripple-element[_ngcontent-%COMP%]{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0,0,.2,1);transform:scale3d(0,0,0);background-color:var(--mat-ripple-color, rgba(0, 0, 0, .1))}.cdk-high-contrast-active[_ngcontent-%COMP%]   .mat-ripple-element[_ngcontent-%COMP%], .cdk-drag-preview[_ngcontent-%COMP%]   .mat-ripple-element[_ngcontent-%COMP%], .cdk-drag-placeholder[_ngcontent-%COMP%]   .mat-ripple-element[_ngcontent-%COMP%]{display:none}.cdk-visually-hidden[_ngcontent-%COMP%]{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl][_ngcontent-%COMP%]   .cdk-visually-hidden[_ngcontent-%COMP%]{left:auto;right:0}.cdk-overlay-container[_ngcontent-%COMP%], .cdk-global-overlay-wrapper[_ngcontent-%COMP%]{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container[_ngcontent-%COMP%]{position:fixed;z-index:1000}.cdk-overlay-container[_ngcontent-%COMP%]:empty{display:none}.cdk-global-overlay-wrapper[_ngcontent-%COMP%]{display:flex;position:absolute;z-index:1000}.cdk-overlay-pane[_ngcontent-%COMP%]{position:absolute;pointer-events:auto;box-sizing:border-box;z-index:1000;display:flex;max-width:100%;max-height:100%}.cdk-overlay-backdrop[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:1000;pointer-events:auto;-webkit-tap-highlight-color:transparent;transition:opacity .4s cubic-bezier(.25,.8,.25,1);opacity:0}.cdk-overlay-backdrop.cdk-overlay-backdrop-showing[_ngcontent-%COMP%]{opacity:1}.cdk-high-contrast-active[_ngcontent-%COMP%]   .cdk-overlay-backdrop.cdk-overlay-backdrop-showing[_ngcontent-%COMP%]{opacity:.6}.cdk-overlay-dark-backdrop[_ngcontent-%COMP%]{background:#00000052}.cdk-overlay-transparent-backdrop[_ngcontent-%COMP%]{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing[_ngcontent-%COMP%]{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation[_ngcontent-%COMP%]{transition:none}.cdk-overlay-connected-position-bounding-box[_ngcontent-%COMP%]{position:absolute;z-index:1000;display:flex;flex-direction:column;min-width:1px;min-height:1px}.cdk-global-scrollblock[_ngcontent-%COMP%]{position:fixed;width:100%;overflow-y:scroll}textarea.cdk-textarea-autosize[_ngcontent-%COMP%]{resize:none}textarea.cdk-textarea-autosize-measuring[_ngcontent-%COMP%]{padding:2px 0!important;box-sizing:content-box!important;height:auto!important;overflow:hidden!important}textarea.cdk-textarea-autosize-measuring-firefox[_ngcontent-%COMP%]{padding:2px 0!important;box-sizing:content-box!important;height:0!important}@keyframes _ngcontent-%COMP%_cdk-text-field-autofill-start{}@keyframes _ngcontent-%COMP%_cdk-text-field-autofill-end{}.cdk-text-field-autofill-monitored[_ngcontent-%COMP%]:-webkit-autofill{animation:_ngcontent-%COMP%_cdk-text-field-autofill-start 0s 1ms}.cdk-text-field-autofill-monitored[_ngcontent-%COMP%]:not(:-webkit-autofill){animation:_ngcontent-%COMP%_cdk-text-field-autofill-end 0s 1ms}.mat-focus-indicator[_ngcontent-%COMP%]{position:relative}.mat-focus-indicator[_ngcontent-%COMP%]:before{inset:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border:var(--mat-focus-indicator-border-width, 3px) var(--mat-focus-indicator-border-style, solid) var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator[_ngcontent-%COMP%]:focus:before{content:""}.cdk-high-contrast-active[_ngcontent-%COMP%]{--mat-focus-indicator-display: block}.mat-mdc-focus-indicator[_ngcontent-%COMP%]{position:relative}.mat-mdc-focus-indicator[_ngcontent-%COMP%]:before{inset:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-mdc-focus-indicator-display, none);border:var(--mat-mdc-focus-indicator-border-width, 3px) var(--mat-mdc-focus-indicator-border-style, solid) var(--mat-mdc-focus-indicator-border-color, transparent);border-radius:var(--mat-mdc-focus-indicator-border-radius, 4px)}.mat-mdc-focus-indicator[_ngcontent-%COMP%]:focus:before{content:""}.cdk-high-contrast-active[_ngcontent-%COMP%]{--mat-mdc-focus-indicator-display: block}.mat-app-background[_ngcontent-%COMP%]{background-color:var(--mat-app-background-color, transparent);color:var(--mat-app-text-color, inherit)}.mat-elevation-z0[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z0[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-0, none)}.mat-elevation-z1[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z1[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-1, none)}.mat-elevation-z2[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z2[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-2, none)}.mat-elevation-z3[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z3[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-3, none)}.mat-elevation-z4[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z4[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-4, none)}.mat-elevation-z5[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z5[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-5, none)}.mat-elevation-z6[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z6[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-6, none)}.mat-elevation-z7[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z7[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-7, none)}.mat-elevation-z8[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z8[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-8, none)}.mat-elevation-z9[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z9[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-9, none)}.mat-elevation-z10[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z10[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-10, none)}.mat-elevation-z11[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z11[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-11, none)}.mat-elevation-z12[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z12[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-12, none)}.mat-elevation-z13[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z13[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-13, none)}.mat-elevation-z14[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z14[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-14, none)}.mat-elevation-z15[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z15[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-15, none)}.mat-elevation-z16[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z16[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-16, none)}.mat-elevation-z17[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z17[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-17, none)}.mat-elevation-z18[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z18[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-18, none)}.mat-elevation-z19[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z19[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-19, none)}.mat-elevation-z20[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z20[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-20, none)}.mat-elevation-z21[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z21[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-21, none)}.mat-elevation-z22[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z22[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-22, none)}.mat-elevation-z23[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z23[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-23, none)}.mat-elevation-z24[_ngcontent-%COMP%], .mat-mdc-elevation-specific.mat-elevation-z24[_ngcontent-%COMP%]{box-shadow:var(--mat-app-elevation-shadow-level-24, none)}.events-master-form[_ngcontent-%COMP%]{position:sticky;bottom:0;background-color:#f5fff4}'],changeDetection:0});let t=e;return t})();var qe=[{path:"",component:Ce,children:[{path:"master",component:xe},{path:"master/user-management",component:X},{path:"master/character/:id",component:Oe},{path:"master/events",component:ee},{path:"player",component:_e},{path:"player/user-management",component:X},{path:"player/events",component:ee}]}],ke=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=j({type:e}),e.\u0275inj=$({imports:[Z.forChild(qe),Z]});let t=e;return t})();var $n=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=j({type:e}),e.\u0275inj=$({imports:[me,ke,fe,ge]});let t=e;return t})();export{$n as HomeModule};
